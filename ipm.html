<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Planet Miner calculator</title>
</head>
<body>
    <p>What do you want to craft?</p>
    <ul>
        <li>
            <select id="item_select" class="item_select" oninput="Update();"></select>
            <input id="txtQuantity" type="number" class="item_quantity" min="0" value="1" oninput="Update();">
        </li>
    </ul>
    <div id="output">

    </div>

    <script src="ipm_data.js"></script>
    <script>
        
        (function() {
            for(i of IPM_DATA){
                if(i.reqs.length>0){
                    var d = document.createElement('option');
                    d.value=i.id;
                    d.text=i.name;
                    item_select.add(d);
                }
            }

            Update();
        })();

        function Update() {
            console.log(GetReqs(item_select.value, parseInt(txtQuantity.value, 10)));

        }

        function GetReqs(item_id, qty, req_list, req_tree){
            req_list = req_list || [];
            req_tree = req_tree || [];

            
            req_list.push({id: item_id, qty: qty});

            var item = IPM_DATA.filter(i=>i.id==item_id)[0];

            for(i of item.reqs) {
                GetReqs(i.id, i.qty * qty, req_list, req_tree);
                
            }

            
            return req_list;
        }
    </script>
</body>
</html>